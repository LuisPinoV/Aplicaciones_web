<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/historial"></ion-back-button>
    </ion-buttons>
    <ion-title>Diagnósticos Médicos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Diagnósticos</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="health-container" *ngIf="paciente">
    <!-- Estadísticas mejoradas -->
    <div class="stats-section" *ngIf="diagnosticos.length > 0">
      <div class="section-header">
        <h3>Resumen Médico</h3>
      </div>
      
      <div class="enhanced-stats-grid">
        <ion-card class="stat-card total">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="medical"></ion-icon>
            </div>
            <div class="stat-number">{{ diagnosticos.length }}</div>
            <div class="stat-label">Total Diagnósticos</div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card recent">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="time"></ion-icon>
            </div>
            <div class="stat-number">{{ getDiagnosticosRecientes() }}</div>
            <div class="stat-label">Recientes (3m)</div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card active">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="pulse"></ion-icon>
            </div>
            <div class="stat-number">{{ getDiagnosticosActivos() }}</div>
            <div class="stat-label">Activos</div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- Acciones rápidas -->
    <div class="quick-actions-section" *ngIf="diagnosticos.length > 0">
      <div class="actions-row">
        <ion-button 
          fill="clear" 
          size="small" 
          class="action-btn filter-btn"
          (click)="openFilter()">
          <ion-icon name="funnel" slot="start"></ion-icon>
          Filtrar
        </ion-button>
        
        <ion-button 
          fill="clear" 
          size="small" 
          class="action-btn sort-btn"
          (click)="sortDiagnostics()">
          <ion-icon name="swap-vertical" slot="start"></ion-icon>
          Ordenar
        </ion-button>
        
        <ion-button 
          fill="solid" 
          size="small" 
          class="action-btn add-btn"
          (click)="addDiagnostic()">
          <ion-icon name="add" slot="start"></ion-icon>
          Nuevo
        </ion-button>
      </div>
    </div>

    <!-- Lista de diagnósticos -->
    <div class="diagnostics-section" *ngIf="diagnosticos.length > 0; else noData">
      <div class="section-header">
        <h3>Historial Completo</h3>
      </div>
      
      <div class="diagnostics-list">
        <app-diagnostico-card 
          *ngFor="let diag of diagnosticos; trackBy: trackByDiagnostico; let i = index" 
          [diagnostico]="diag"
          [index]="i"
          class="diagnostic-item">
        </app-diagnostico-card>
      </div>
    </div>

    <!-- Estado vacío mejorado -->
    <ng-template #noData>
      <div class="empty-state">
        <div class="empty-icon">
          <ion-icon name="document-text-outline"></ion-icon>
        </div>
        <h3>Sin diagnósticos registrados</h3>
        <p>Este paciente no tiene diagnósticos médicos registrados en su historial clínico.</p>
        
        <div class="empty-actions">
          <ion-button 
            expand="block" 
            fill="solid" 
            color="primary"
            (click)="addDiagnostic()">
            <ion-icon name="add-circle" slot="start"></ion-icon>
            Agregar primer diagnóstico
          </ion-button>
          
          <ion-button 
            expand="block" 
            fill="outline" 
            color="medium"
            (click)="importDiagnostics()">
            <ion-icon name="cloud-upload" slot="start"></ion-icon>
            Importar historial
          </ion-button>
        </div>
      </div>
    </ng-template>
  </div>
</ion-content>