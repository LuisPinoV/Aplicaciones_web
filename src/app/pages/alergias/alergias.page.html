<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/historial"></ion-back-button>
    </ion-buttons>
    <ion-title>Alergias</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Alergias</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="health-container" *ngIf="paciente">
    <!-- Estadísticas mejoradas -->
    <div class="stats-section" *ngIf="alergias.length > 0">
      <div class="section-header">
        <h3>Resumen Médico</h3>
      </div>
      
      <div class="enhanced-stats-grid">
        
        <!-- <ion-card class="stat-card total">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="medical"></ion-icon>
            </div>
            <div class="stat-number">{{ alergias.length }}</div>
            <div class="stat-label">Total Alergias</div>
          </ion-card-content>
        </ion-card> -->

        <ion-card class="stat-card leve">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="time"></ion-icon>
            </div>
            <div class="stat-number">{{ getAlergiasLeves() }}</div>
            <div class="stat-label">Leves</div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card moderada">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="time"></ion-icon>
            </div>
            <div class="stat-number">{{ getAlergiasModeradas() }}</div>
            <div class="stat-label">Moderadas</div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card alta">
          <ion-card-content>
            <div class="stat-icon">
              <ion-icon name="time"></ion-icon>
            </div>
            <div class="stat-number">{{ getAlergiasAltas() }}</div>
            <div class="stat-label">Alta</div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>
    <!-- Acciones rápidas -->
    <div class="quick-actions-section" *ngIf="alergias.length > 0">
      <div class="actions-row">
        <ion-button 
          fill="clear" 
          size="small" 
          class="action-btn filter-btn"
          (click)="openFilter()">
          <ion-icon name="funnel" slot="start"></ion-icon>
          Filtrar
        </ion-button>
        
        <ion-button 
          fill="clear" 
          size="small" 
          class="action-btn sort-btn"
          (click)="sortAlergias()">
          <ion-icon name="swap-vertical" slot="start"></ion-icon>
          Ordenar
        </ion-button>
        
        <ion-button 
          fill="solid" 
          size="small" 
          class="action-btn add-btn"
          (click)="addAlergia()">
          <ion-icon name="add" slot="start"></ion-icon>
          Nuevo
        </ion-button>
      </div>
    </div>
    <div class="alergias-section" *ngIf="alergias.length > 0; else noData">
      <div class="section-header">
        <h3>Historial Completo</h3>
      </div>
      
      <div class="alergias-list">
        <app-alergia-card 
          *ngFor="let alergia of alergias; trackBy: trackByAlergia; let i = index" 
          [alergia]="alergia"
          [index]="i"
          class="alergia-item">
        </app-alergia-card>
      </div>
    </div>
    <ng-template #noData>
      <div class="empty-state">
        <div class="empty-icon">
          <ion-icon name="document-text-outline"></ion-icon>
        </div>
        <h3>Sin alergias registradas</h3>
        <p>Este paciente no tiene alergias registradas.</p>
        
        <div class="empty-actions">
          <ion-button 
            expand="block" 
            fill="solid" 
            color="primary"
            (click)="addAlergia()">
            <ion-icon name="add-circle" slot="start"></ion-icon>
            Agregar primer alergia
          </ion-button>
          
          <ion-button 
            expand="block" 
            fill="outline" 
            color="medium"
            (click)="importAlergias()">
            <ion-icon name="cloud-upload" slot="start"></ion-icon>
            Importar historial
          </ion-button>
        </div>
      </div>
    </ng-template>
  </div>
</ion-content>
